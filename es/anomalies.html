<!DOCTYPE HTML>
<!--
Focal Point by Pixelarity
pixelarity.com @pixelarity
License: pixelarity.com/license
-->
<html lang="es">
    <head>
        <title>Anomalías Criminales - Delincuencia en México</title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="alternate" hreflang="en" href="http://crimenmexico.diegovalle.net/en/anomalies.html" />

        <!-- Schema.org markup for Google+ -->
        <meta itemprop="name" content="Mexico Crime Report">
        <meta itemprop="description" content="Municipios donde la criminalidad presentó un patrón anormal">
        <meta itemprop="image" content="http://crimenmexico.diegovalle.net/en/images/infographics/thumbnails/municipios_jun_2015.png">

        <!-- Twitter Card data -->
        <meta name="twitter:card" content="summary_large_image">
        <meta name="twitter:site" content="@diegovalle">
        <meta name="twitter:title" content="Anomalías Criminaes">
        <meta name="twitter:description" content="Municipios donde la criminalidad presentó un patrón anormal">
        <meta name="twitter:creator" content="@diegovalle">
        <!-- Twitter summary card with large image must be at least 280x150px -->
        <meta name="twitter:image:src" content="http://crimenmexico.diegovalle.net/es/images/infographics/thumbnails/municipios_jun_2015.png">

        <!-- Open Graph data -->
        <meta property="og:title" content="Anomalías Criminales" />
        <meta property="og:type" content="article" />
        <meta property="og:url" content="http://crimenmexico.diegovalle.net/es/anomalies.html" />
        <meta property="og:image" content="http://crimenmexico.diegovalle.net/es/images/infographics/thumbnails/municipios_jun_2015.png" />
        <meta property="og:description" content="Municipios donde la criminalidad presentó un patrón anormal" />
        <meta property="og:site_name" content="crimenmexico" />
        <link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png">
<link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
<link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="/manifest.json">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-TileImage" content="/mstile-144x144.png">
<meta name="theme-color" content="#ffffff">


        <!--[if lte IE 8]><script src="/assets/js/ie/html5shiv.js"></script><![endif]-->
        <link rel="stylesheet" href="/assets/css/main.css" />
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/metrics-graphics/2.6.0/metricsgraphics.min.css" />
        <!--[if lte IE 8]><link rel="stylesheet" href="/assets/css/ie8.css" /><![endif]-->
        <link rel="stylesheet" href="/assets/css/crimenmexico.css" />
    </head>
    <body class="no-sidebar">
        <div id="page-wrapper">
            <div class="container">

                <!-- Header Wrapper -->
                <div id="header-wrapper" class="wrapper">

                    <!-- Header -->
                    <div id="header">

                        <!-- Logo -->
                        <a href="index.html" id="logo">
                            <span class="pennant"><span class="icon fa-bar-chart"></span></span>
                            <h1>CrimenMexico</h1>
                        </a>



                        <h2 style="padding-top: 2em;
                                   text-align: center;">Todos los municipios con un pico de criminalidad durante el último periodo disponible</h2>



                        <!-- Nav -->
                        <nav id="nav">
                            <ul>
                                 <li><a href="/es/index.html">Inicio</a></li>
                                <!-- <li>
                                <a href="#">Dropdown</a>
                                <ul>
                                <li><a href="#">Lorem ipsum dolor</a></li>
                                <li><a href="#">Magna phasellus</a></li>
                                <li><a href="#">Etiam dolore nisl</a></li>
                                <li>
                                <a href="#">Phasellus consequat</a>
                                <ul>
                                <li><a href="#">Lorem ipsum dolor</a></li>
                                <li><a href="#">Phasellus consequat</a></li>
                                <li><a href="#">Magna phasellus</a></li>
                                <li><a href="#">Etiam dolore nisl</a></li>
                                <li><a href="#">Veroeros feugiat</a></li>
                                </ul>
                                </li>
                                <li><a href="#">Veroeros feugiat</a></li>
                                </ul>
                                </li> -->
                                <li><a href="/es/states.html">Estados</a></li>
                                <li><a href="#">Municipios</a>
                                    <ul>
                                        <li><a href="/es/municipios-map.html">Mapa</a></li>
                                        <li><a href="/es/municipios.html">Series de Tiempo</a></li>
                                    </ul>
                                </li>
                                <li class="current_page_item"><a href="/es/anomalies.html">Anomalías</a></li>
                                <li><a href="/es/infographics.html">Infográficas</a></li>
                                <li><a href="/es/datos.html">Datos</a></li>
                            </ul>
                        </nav>

                    </div>

                </div>

                <!-- Banner Wrapper -->
                <div id="banner-wrapper" class="wrapper">
                    <div class="row 200%">
                        <!-- Content -->
                        <div id="content" class="8u 12u(mobile)">
                            <article>

                                <h2 id ="hom" class="chart-title"></h2>
                                <div class="row" id="small-multiples-hom"></div>

                            </article>
                        </div>

                        <!-- Sidebar -->
                        <div id="sidebar" class="4u 12u(mobile)">
                            <section>
                                <div class="row">
                                    <div class="12u 12u(mobile)" id="hom-map"></div>
                                </div>

                            </section>
                        </div>
                    </div>

                    <div class="row 200%">

                        <!-- Content -->
                        <div id="content" class="8u 12u(mobile)">
                            <article>
                                <h2 id ="rvcv" class="chart-title"></h2>
                                <div class="row" id="small-multiples-rvcv"></div>

                            </article>
                        </div>
                        <!-- Sidebar -->
                        <div id="sidebar" class="4u 12u(mobile)">
                            <section>
                                <div class="12u 12u(mobile)" id="rvcv-map"></div>
                            </section>
                        </div>
                    </div>

                    <div class="row 200%">

                        <!-- Content -->
                        <div id="content" class="8u 12u(mobile)">
                            <article>
                                <h2 id ="rvsv" class="chart-title"></h2>
                                <div class="row" id="small-multiples-rvsv"></div>

                            </article>
                        </div>
                        <!-- Sidebar -->
                        <div id="sidebar" class="4u 12u(mobile)">
                            <section>
                                <div class="12u 12u(mobile)" id="rvsv-map"></div>
                            </section>
                        </div>
                    </div>

                    <div class="row 200%">

                        <!-- Content -->
                        <div id="content" class="8u 12u(mobile)">
                            <article>
                                <h2 id ="lesions" class="chart-title"></h2>
                                <div class="row" id="small-multiples-lesions"></div>

                            </article>
                        </div>
                        <!-- Sidebar -->
                        <div id="sidebar" class="4u 12u(mobile)">
                            <section>
                                <div class="12u 12u(mobile)" id="lesions-map"></div>
                            </section>
                        </div>
                    </div>

                    <div class="row 200%">

                        <!-- Content -->
                        <div id="content" class="8u 12u(mobile)">
                            <article>
                                <h2 id ="kidnapping" class="chart-title"></h2>
                                <div class="row" id="small-multiples-kidnapping"></div>

                            </article>
                        </div>
                        <!-- Sidebar -->
                        <div id="sidebar" class="4u 12u(mobile)">
                            <section>
                                <div class="12u 12u(mobile)" id="kidnapping-map"></div>
                            </section>
                        </div>
                    </div>

                    <div class="row 200%">

                        <!-- Content -->
                        <div id="content" class="8u 12u(mobile)">
                            <article>
                                <h2 id ="ext" class="chart-title"></h2>
                                <div class="row" id="small-multiples-ext"></div>
                            </article>
                        </div>
                        <!-- Sidebar -->
                        <div id="sidebar" class="4u 12u(mobile)">
                            <section>
                                <div class="12u 12u(mobile)" id="ext-map"></div>
                            </section>
                        </div>
                    </div>


                </div>
                <div id="banner-wrapper" class="wrapper">
                    <!-- Banner --><section id="banner">
                    <h2>Explicación</h2>
                    <p style="text-align:left;">
                        Detectar municipios con una cantidad inusual de crímenes debería
                        de ser una de las principales estrategias del gobierno
                        para combatir el crimen. Estas gráficas ayudan
                        a monitorear los picos criminales en cada uno de los más de
                        2,400 municipios para que el gobierno los pueda atender
                        (LOL). Las anomalías sólo son detectas para los datos nuevos desde el último update (usualmente el último mes), pero se puede consultar información histórica
                        gracias a las <a href="/es/infographics.html">infografías</a>.<br><br>
                    </p><p style="text-align:left;">Tanto las
                        anomalías positivas como negativas son
                        detectadas. Algunos municipios reportan
                        incorrectamente los valores faltantes como
                        cero, o bien cometen errores a la hora de
                        capturar los datos. Es difícil saber cuando
                        esto ocurre y como los falsos positivos son
                        menos costosos que los falsos negativos no
                        hice ningún ajuste. Estos municipios son los
                        que presentaron una anomalía, no los más
                        violentos.

                        </p>
                    </section></div>



                <!-- Footer Wrapper -->
                    <div id="footer-wrapper" class="wrapper">

                        <!-- Footer -->
                        <section id="footer">
                            <header>
                                <h2>Acerca de:</h2>
                            </header>
                            <p>Autor: <a href="http://www.diegovalle.net">Diego Valle</a></p>
                            <p>Por favor visiten <a href="https://hoyodecrimen.com">hoyodecrimen.com</a> para información delincuencial del DF</p>
                            <ul class="contact">
                                <li><a href="https://twitter.com/diegovalle" class="icon fa-twitter"><span>Twitter</span></a></li>
                                <li><a href="https://facebook.com/diegovalle" class="icon fa-facebook"><span>Facebook</span></a></li>
                                <li><a href="https://github.com/diegovalle" class="icon fa-github"><span>Instagram</span></a></li>
                                <li><a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#100;&#105;&#101;&#103;&#111;&#64;&#100;&#105;&#101;&#103;&#111;&#118;&#97;&#108;&#108;&#101;&#46;&#110;&#101;&#116;"  class="icon fa-envelope"><span>&#100;&#105;&#101;&#103;&#111;&#64;&#100;&#105;&#101;&#103;&#111;&#118;&#97;&#108;&#108;&#101;&#46;&#110;&#101;&#116;</span></a>
                                </li>
                            </ul>
                        </section>

                        <!-- Copyright -->
                        <div id="copyright">
                            &copy; Diego Valle-Jones. Todos los derechos reservados.<br>
                            <a href="/en/index.html">English Version</a>
                        </div>

                    </div>

            </div>
        </div>
         <div class="a2a_kit a2a_kit_size_32 a2a_floating_style a2a_vertical_style" style="left:0px; top:150px;">
                    <a class="a2a_button_facebook"></a>
                    <a class="a2a_button_twitter"></a>
                    <a class="a2a_button_reddit"></a>
                    <a class="a2a_dd" href="http://www.addtoany.com/share_save"></a>
                </div>

        <script type="text/javascript" src="//static.addtoany.com/menu/page.js"></script>
        <script>
         (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
             (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                                  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
         })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

         ga('create', 'UA-100264-7', 'auto');
         ga('send', 'pageview');

        </script>
        <!-- Scripts -->
        <script src="/assets/js/jquery.min.js"></script>
        <script src="/assets/js/jquery.dropotron.min.js"></script>
        <script src="/assets/js/jquery.selectorr.min.js"></script>
        <script src="/assets/js/jquery.poptrox.min.js"></script>
        <script src="/assets/js/skel.min.js"></script>
        <script src="/assets/js/skel-viewport.min.js"></script>
        <script src="/assets/js/util.js"></script>
        <!--[if lte IE 8]><script src="/assets/js/ie/respond.min.js"></script><![endif]-->
        <script src="/assets/js/main.js"></script>
        <script src='//cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js'></script>
        <script src='//cdnjs.cloudflare.com/ajax/libs/topojson/1.6.19/topojson.min.js'></script>
        <script src='//cdnjs.cloudflare.com/ajax/libs/metrics-graphics/2.6.0/metricsgraphics.js'></script>
        <script src='//cdnjs.cloudflare.com/ajax/libs/lodash.js/3.10.0/lodash.min.js'></script>
        <script src="/assets/js/d3-tip/index.js"></script>
        <script src="/assets/js/d3-legend/d3-legend.min.js"></script>
        <script>
         var homicidio_doloso = 'Homicidio Intencional - ',
             secuestro = 'Secuestro - ',
             extorsion = 'Extorsión - ',
             rvcv = 'Robo de Vehículo C.V. - ',
             rvsv = 'Robo de Vehículo S.V. - ',
             national_text = 'Nacional',
             annualized_rate = 'tasa anualizada',
             rate_text = ', tasa: ',
             count_text = ', número: ',
             rate = "Tasa:", count = "Número:", pop = "Población:";
        </script>
        <script>
         var selected_value = 'hd', muns;
         var monthNames = [
             "Jan", "Feb", "Mar",
             "Apr", "May", "Jun", "Jul",
             "Aug", "Sep", "Oct",
             "Nov", "Dec"
         ];
         var round = d3.format(".1f");
         var format=d3.time.format('%b %Y');
             var draw_line_chart = function(crime_type, id){
                 groups=_.groupBy(muns[crime_type], function(x) {return x.name});
                 byrate = _.map(groups, function(g, key) {
                     return { name: key,
                              rate: _.reduce(g, function(m,x) { return (x.rate === null ? m : x.rate); }, 0) };
                 });
                 muns_ordered = _.pluck(_.sortBy(byrate, "rate"), "name").reverse();

                 _.map(muns_ordered, function(x) {
                     if (document.getElementById('line' + x.replace(/ |\./g, '')
                                                           .replace(/,/g, '')) === null) {
                                                               $('<div  class="3u 12u(mobile)" ><div class =' + id + ' id="'+ 'line' + x.replace(/ |\./g, '')
                                                                                                                                        .replace(/,/g, '') + crime_type + '"></div></div>').appendTo(id);
                     }
                 });
                 $('.' + id.replace(/#/g, '')).each(function(index, obj){
                     $(obj).attr('id', 'line' + muns_ordered[index].replace(/ |\./g, '')
                                                                   .replace(/,/g, ''));
                 });


                 var filterCrime = function(data, name) {
                     data = _.filter(data, { 'name': name });
                     if (typeof(data[0].date) !== 'object')
                         data = MG.convert.date(data, 'date');
                     return(data)
                 }
                 max_rate = _.max(muns[crime_type], 'rate')['rate'];
                 var markers = [{
                     'date': new Date('Mon Jun 01 2015 00:00:00 GMT-0600 (CST)'),
                     'label': 'Anomaly'
                 }];

                 var line_chart = function(data, title, target) {
                     var line_options = {
                         height: 150,
                         max_y: max_rate,
                         area: false,
                         full_width: true,
                         left: 60,
                         buffer: 0,
                         show_year_markers: false,
                         // width:281,
                         //missing_is_hidden: true,
                         interpolate: "linear",
                         x_accessor: 'date',
                         y_accessor: 'rate',
                         small_text: true,
                         xax_count: 3,
                         xax_format: d3.time.format('%b'),
                         y_extended_ticks: true,
                         y_label: annualized_rate,
                         mouseover: function(d, i) {
                             var date = new Date(d.date);
                             var day = d.date.getDate();
                             var monthIndex = d.date.getMonth();
                             var year = d.date.getFullYear();
                             d3.select("#line" + target.replace(/ |\./g, '')
                                                       .replace(/,/g, '') + crime_type + ' svg .mg-active-datapoint')
                               .text(monthNames[monthIndex] + '-' + year + rate_text + round(d.rate) + count_text + d.count);
                         },
                     };
                     line_options.data = line_values;
                     line_options.title = title.split(",")[0].substring(0, 14) + ', ' + title.split(",")[1];
                     line_options.target = "#line" + target.replace(/ |\./g, '')
                                                           .replace(/,/g, '') + crime_type;
                     MG.data_graphic(line_options);
                 }
                 //console.time("concatenation");
                 _.forEach(muns_ordered, function(x) {
                     line_values = filterCrime(muns[crime_type], x);
                     line_chart(line_values, x, x)
                         return
                 });
             }



         d3.json('/assets/json/estatal.json', function(mx){
             d3.json('/assets/json/cities.json', function(cities) {

                 draw_map = function(id, crime) {
                     if (typeof(cities[crime]) === "undefined") {
                         return
                     };
                     var selection = d3.select(id);
                     var width = selection[0][0].clientWidth - 20;
                     var height = width*1;
                     // new projection
                     var center = d3.geo.centroid(topojson.feature(mx, mx.objects.collection))
                         var scale  = 130;
                     var offset = [width/2, height/2];
                     var vis = d3.select(id).append("svg")
                                 .attr("class", "OrRd")
                                 .attr("width", width).attr("height", height);

                     var projection = d3.geo.mercator().scale(scale).center(center)
                                        .translate(offset);
                     var path = d3.geo.path().projection(projection);
                     // using the path determine the bounds of the current map and use
                     // these to determine better values for the scale and translation
                     var bounds  = path.bounds(topojson.feature(mx, mx.objects.collection));
                     var hscale  = scale*width  / (bounds[1][0] - bounds[0][0]);
                     var vscale  = scale*height / (bounds[1][1] - bounds[0][1]);
                     var scale   = (hscale < vscale) ? hscale : vscale;
                     var offset  = [width - (bounds[0][0] + bounds[1][0])/2,
                                    height - (bounds[0][1] + bounds[1][1])/2];


                     projection = d3.geo.mercator().center(center)
                                    .scale(scale*0.89).translate(offset);
                     path = path.projection(projection);

                     //Group for the map features
                     var features = vis.append("g")
                                       .attr("class","features");

                     //Create zoom/pan listener
                     //Change [1,Infinity] to adjust the min/max zoom scale
                     var zoom = d3.behavior.zoom()
                                  .scaleExtent([1, Infinity])
                                  .on("zoom",zoomed);

                     vis.call(zoom);
                     //Update map on zoom/pan
                     function zoomed() {
                         features.attr("transform", "translate(" + zoom.translate() + ")scale(" + zoom.scale() + ")")
                                 .selectAll("path").style("stroke-width", 0.5 / zoom.scale() + "px" );
                     }

                     features.selectAll("path")
                                 .data(topojson.feature(mx,mx.objects.collection).features).enter()
                                 .append("path")
                                 .attr("d",path);

                     max_count = _.max(cities[crime], 'count')['count'];
                     min_count = _.min(cities[crime], 'count')['count'];
                     var radius = d3.scale.sqrt()
                                    .domain([min_count, max_count])
                                    .range([4, 8]);
                     var cellnum = min_count == max_count ? 1 : min_count + 1 == max_count ? 2 : 3;
                     var sizeLegend = d3.legend.size()
                                        .labelFormat(d3.format(".0f"))
                                        .scale(radius)
                                        .shape("circle")
                                        .shapePadding(3)
                                        .cells(cellnum)
                                        .labelOffset(10);
                     vis.append("g")
                        .attr("transform", "translate(250, 60)")
                        .call(sizeLegend);

                     tip = d3.tip().attr('class', 'd3-tip')
                             .offset([-10, 0])
                             .html(function(d) {
                                 return "<strong>" + d.name + "</strong><br>" +
                                        "<strong>"+rate+"</strong> <span style='color:white'>" + round(d.rate) + "</span><br>" +
                                        "<strong>"+count+"</strong> <span style='color:white'>" +d.count + "</span><br>";
                             });
                     vis.call(tip)

                         features.append("g")
                        .attr("class", "bubble").selectAll("circle")
                        .data(cities[crime]).enter()
                        .append("circle")
                        .attr("cx", function (d) {
                            return projection([d.long, d.lat])[0];
                        })
                        .attr("cy", function (d) { return projection([d.long, d.lat])[1]; })
                        .attr("r", function(d) { return radius(d.count); })
                        .on('mouseover', tip.show)
                        .on('mouseout', tip.hide);
                 }
                 draw_map("#hom-map", "hom");
                 draw_map("#rvcv-map", "rvcv");
                 draw_map("#rvsv-map", "rvsv");
                 draw_map("#lesions-map", "lesions");
                 draw_map("#kidnapping-map", "kidnapping");
                 draw_map("#ext-map", "ext");
             });
         });

         $( window ).load(function() {
             d3.json('/assets/json/anomalies.json', function(data) {
                 muns = data;
                 if (muns['hom'].length !== 0) {
                     d3.select('#hom').text('Homicidio Intencional').style('padding', '10px');
                     draw_line_chart('hom', '#small-multiples-hom');
                 }
                 if (muns['rvcv'].length !== 0) {
                     d3.select('#rvcv').text('Robo de Vehículo con Violencia').style('padding', '10px');
                     draw_line_chart('rvcv', '#small-multiples-rvcv');
                 }
                 if (muns['rvsv'].length !== 0) {
                     d3.select('#rvsv').text('Robo de Vehículo sin Violencia').style('padding', '10px');
                     draw_line_chart('rvsv', '#small-multiples-rvsv');
                 }
                 if (muns['lesions'].length !== 0) {
                     d3.select('#lesions').text('Lesiones Intencionales').style('padding', '10px');
                     draw_line_chart('lesions', '#small-multiples-lesions');
                 }
                 if (muns['kidnapping'].length !== 0) {
                     d3.select('#kidnapping').text('Secuestro').style('padding', '10px');
                     draw_line_chart('kidnapping', '#small-multiples-kidnapping');
                 }
                 if (muns['ext'].length !== 0) {
                     d3.select('#ext').text('Extorsiones').style('padding', '10px');
                     draw_line_chart('ext', '#small-multiples-ext');
                 }

             });

             $('#crimeSelect').on('change', function() {
                 selected_value = this.value;
                 $("body").addClass("loading");
                 draw_line_chart();
                 $("body").removeClass("loading");
             });
         });
        </script>
    </body>
</html>
